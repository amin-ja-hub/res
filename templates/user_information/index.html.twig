{% extends 'base.html.twig' %}

{% block title %}UserInformation index{% endblock %}
{% block css %}
                                                <style>
    .progress {
  --bs-progress-bg: #d8d8d8;
  --bs-progress-font-size:1.2rem;
}
                                                </style>
{% endblock %}
{% block body %}
    <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
            <!--begin::Post-->
            <div class="post d-flex flex-column-fluid" id="kt_post">
                    <!--begin::Container-->
                    <div id="kt_content_container" class="container-xxl">
                            <!--begin::محصولات-->
                                    <!--begin::کارت body-->
                        {% for result in results %}
                            <div class="card card-flush">

                                <div class="card-body">
                                    <div class="d-flex">
                                        <h3 class="px-3">عنوان رزومه: <span class="bg-primary rounded">{{ result.userInformation.name }}</span></h3>
                                        <h3 class="px-3" style="width: 60%;">
                                            اطلاعات تکمیل شده : <span class="bg-success rounded">%{{ result.completion }}</span>
                                        {% if result.completion != 100 %}
                                            <!-- Show edit button if not complete -->
                                            <a href="{{ path('app_user_information_edit', {'id': result.userInformation.id}) }}" class="btn btn-info py-0">تکمیل کردن اطلاعات</a>
                                        {% else %}
                                            <!-- When completion is 100%, handle product-related checks -->
                                            {% if result.userInformation.product %}
                                                {% if result.hasPurchasedProduct1 %}
                                                <a href="{{ path('app_user_information_show', {'id': result.userInformation.id, 'temp': result.userInformation.product }) }}" class=" p-0">
                                                     بازدید
                                                </a>
                                                {% else %}
                                                    <span class="ps-5"> قالب انتخابی شما خریداری نشده</span>
                                                    <a href="#">خرید قالب</a>
                                                {% endif %}
                                                <!-- Product is associated -->

                                            {% else %}
                                                <!-- No product associated -->
                                                <span class="text-muted p-1">قالب رزومه ی خود را انتخاب کنید.</span>
                                            {% endif %}
                                        {% endif %}

                                    </h3>
                                        <h3>
                                            <a class="" href="{{ path('app_user_information_edit', {'id': result.userInformation.id}) }}">ویرایش </a>
                                        </h3>
                                    </div>

                                    <div class="d-flex">
                                        <div style="width: 85%;" class="progress h-45px">
                                            <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="{{ result.completion }}" aria-valuemin="0" aria-valuemax="100" style="width:{{ result.completion }}%">
                                                {{ result.completion }}%
                                            </div>
                                        </div>
                                        <!--end::Menu-->
                                        <div class="dropdown">
                                            <button class="btn btn-secondary dropdown-toggle ms-3" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                                انتخاب قالب
                                            </button>
                                            <ul class="dropdown-menu overflow-y-auto h-250px" aria-labelledby="dropdownMenuButton1">
                                                {% for productPurchase in result.productPurchases %}
                                                    <li class="d-flex align-items-center p-2">
                                                        <div style="flex-grow: 1;">
                                                            <div><span>قالب:{{ productPurchase.product.title }}</span></div>
                                                            <a href="{{ path('app_user_information_show', {'id': result.userInformation.id, 'temp': productPurchase.product.HtmlFile }) }}" class="btn btn-primary">پیشنمایش</a>
                                                            {% if productPurchase.hasPurchased %}
                                                                <div class="text-success">شما این محصول را خریداری کرده‌اید</div>
                                                            {% else %}
                                                                <div class="text-danger">شما این محصول را خریداری نکرده‌اید</div>
                                                            {% endif %}
                                                        </div>
                                                        {% if productPurchase is not null and productPurchase is iterable and productPurchase.product is not null and productPurchase.product.Image is not null %}
                                                            <img src="{{ productPurchase.product.Image.path ~ '/'~ productPurchase.product.Image.name ~ '.'~ productPurchase.product.Image.format }}" alt="Image {{ loop.index }}" class="ms-3" style="flex-shrink: 0 ; width: 120px">
                                                        {% else %}
                                                            {# Handle the case where productPurchase is not an object, or other attributes are missing #}
                                                            <p>Image not available</p>
                                                        {% endif %}
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
{% if result.completion != 100 %}
    <!-- Show edit button if not complete -->
    <span class="text-info p-0"><i class="bi bi-info-circle"></i> با تکمیل و به ‌روزرسانی رزومه خود، احتمال قبولی در مصاحبه‌های شغلی افزایش می‌یابد.</span>
{% else %}
    <!-- When completion is 100%, handle product-related checks -->
    {% set hasProduct = result.userInformation.product %}
    {% set purchased = result.hasPurchasedProduct1 %}
    {% if hasProduct %}
        <!-- Product is associated -->
        <span class="text-muted p-1">
            {{ purchased ? 'تبریک میگم رزومه شما تکمیل و آماده دریافت میباشد.' : 'تبریک میگم رزومه شما تکمیل لطفا قالب انتخابی را خریداری کنید' }}
        </span>
    {% else %}
        <!-- No product associated -->
        <span class="text-muted p-1">تبریک میگم رزومه شما تکمیل و آماده دریافت میباشد.</span>
    {% endif %}
        <a href="{{ path('app_user_information_show', {'id': result.userInformation.id, 'temp': 'show' }) }}" class="btn btn-primary p-1">
            pdf
        </a>
{% endif %}
                                </div>
                            </div>
                        {% endfor %}
                                    <!--end::کارت body-->
                            <!--end::محصولات-->
                    </div>
                    <!--end::Container-->
            </div>
            <!--end::Post-->
    </div>
    <a href="{{ path('app_user_information_new') }}">Create new</a>
{% endblock %}
